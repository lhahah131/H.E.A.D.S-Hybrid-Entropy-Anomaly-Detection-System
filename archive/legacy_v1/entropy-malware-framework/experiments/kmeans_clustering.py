import pandas as pd
import matplotlib.pyplot as plt
from sklearn.preprocessing import StandardScaler
from sklearn.decomposition import PCA
from sklearn.cluster import KMeans

#======================
#LOAD DATA
#======================

df = pd.read_csv("features/master_features.csv")

file_ids = df["file_id"]
X = df.drop(columns=["file_id"])

#======================
#SCALING
#======================

scaler =  StandardScaler()
X_scaled = scaler.fit_transform(X)

#======================
#KMEANS
#======================

KMeans = KMeans(n_clusters=4, random_state=42, n_init=10)
clusters = KMeans.fit_predict(X_scaled)

df["cluster"] = clusters

print("\nCluster Assingments:")
for file_id, cluster_id in zip(file_ids, clusters):
    print(f"{file_id} -> Cluster {cluster_id}")

#=======================
# PCA FOR VISUALIZATION
#=======================
pca = PCA(n_components=2)
X_pca = pca.fit_transform(X_scaled)

plt.figure(figsize=(8,6))
scatter = plt.scatter(X_pca[:,0], X_pca[:,1], c=clusters)

for i, txt in enumerate(file_ids):
    plt.annotate(txt, (X_pca[i, 0], X_pca[i,1]), fontsize=8)

plt.title("K-Means Clustering")
plt.xlabel("Principal Component 1")
plt.ylabel("Principal Component 2")
plt.grid(True)
plt.colorbar(scatter, label="Cluster")
plt.show()